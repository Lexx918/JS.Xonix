<body onload='function a(){clearInterval(T),alert(":("),R--}function b(a,b){return(a=a.data)&&""+a[0]+","+a[1]+","+a[2]==b}function c(a,b){return a&&_[a[0]][a[1]]==b}function d(a,b,c){g(c),$.fillRect(a*S,b*S,C,C),_[a][b]=c}function g(a){$.fillStyle="rgb("+a+")"}function n(){var a=[];for(y=2;H-2>y;y++)for(x=2;W-2>x;x++)_[x][y]==B&&(s=o(x,y,"1,1,1"),P+=s,a.push([x,y,s])),_[x][y]==K&&(d(x,y,F),P++);for(i=a.length;i--;)j=a[i],o(j[0],j[1],j[2]?F:B);100*P/3344>75&&alert("Win!")}function o(a,b,c){var f,g,i=[],k=_[a][b],l=0;for(m=0,i.push([a,b,4]);g=i.pop();)a=g[0],b=g[1],j=g[2],f=_[a][b],e=f==N,(f==k||e)&&(d(a,b,c),l++,m+=e,a&&2!=j&&i.push([a-1,b,0]),b&&3!=j&&i.push([a,b-1,1]),w>a&&0!=j&&i.push([a+1,b,2]),h>b&&1!=j&&i.push([a,b+1,3]));return m?0:l}S=8,C=8,W=80,H=48,w=W-1,h=H-1,X=7,Y=1,V=2,_=[],R=M=U=u=i=j=x=y=v=s=P=$=e=T=0,B="0,0,0",F="0,168,168",K="168,0,168",N="168,0,0",E=[{x:8,y:9,v:0},{x:9,y:8,v:2}],onkeyup=function(e){if(V=e.which%37%4,!M&&(!V&&X||1==V&&Y||2==V&&w>X||V>2&&h>Y)&&M++,!T){if(!$)for($=z.getContext("2d"),g(F),$.fillRect(0,0,W*S,H*S),g(B),$.fillRect(16,16,608,352),U=$.getImageData(X*S,Y*S,C,C),x=W;x--;)for(_[x]=[],y=H;y--;)_[x][y]=x>1&&W-2>x&&y>1&&H-2>y?B:F;T=setInterval(function(){if(!R++){if(M){if($.putImageData(U,X*S,Y*S),b(U,B)&&d(X,Y,K),!V&&X&&X--,1==V&&Y&&Y--,2==V&&w>X&&X++,V>2&&h>Y&&Y++,u=$.getImageData(X*S,Y*S,C,C),b(u,K))return a();b(U,B)&&b(u,F)&&(M=0,n()),U=u}for(i=E.length;i--;){if(e=E[i],x=e.x,y=e.y,v=e.v,Z=[y?[x,y-1]:0,w>x&&y?[x+1,y-1]:0,w>x?[x+1,y]:0,w>x&&h>y?[x+1,y+1]:0,h>y?[x,y+1]:0,x&&h>y?[x-1,y+1]:0,x?[x-1,y]:0,x&&y?[x-1,y-1]:0],k=2*v,l=Z[k++],f=Z[k++],r=Z[k%8],c(l,K)||c(f,K)||c(r,K))return a();l=c(l,B),f=c(f,B),r=c(r,B),l&&f&&r?(d(x,y,B),x+=2>v?1:-1,y+=v%3?1:-1,d(x,y,N),e.x=x,e.y=y):v+=l?r?2:3:1+!r,e.v=v%4}d(X,Y,"168,168,168"),R--}},50)}}'><canvas id=z width=640 height=384>